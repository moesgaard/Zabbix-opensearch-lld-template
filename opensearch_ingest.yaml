zabbix_export:
  version: "7.0"
  template_groups:
    - uuid: f43b9a15b7374df3ad367ead192d0c64
      name: "Opensearch"
  templates:
    - uuid: 2bc1addd9ff642b98d6fff634ca7c256
      template: "Opensearch  Ingest Node Monitoring "
      name: "Opensearch  Ingest Node Monitoring "
      description: "This template is automatic added to Opensearch LLD  discovered with the cluster manager role."
      groups:
        - name: "Opensearch"
      items:
        - uuid: 40af50735e71463294f3bac0247cf6e3
          name: "Opensearch Discover nodes in cluster"
          type: SCRIPT
          key: opensearch.discover.nodes.stats
          history: 1h
          value_type: TEXT
          trends: "0"
          params: |
            parameters = JSON.parse(value);
            master= parameters['master'];
            port = parameters['port'];
            host = parameters['host']; 
            auth = btoa(parameters['username']+":"+parameters['password'])
            request = new HttpRequest();
            request.addHeader('Authorization: Basic '+auth);
            response = request.get("https://"+master+":"+port+"/_nodes/"+host+"/stats");  
            if(request.getStatus() == "200" ){
            	return response;
            }
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.nodes
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - "120"
          timeout: 30s
          parameters:
            - name: auth
              value: "{$OPENSEARCH.APIKEY}"
            - name: host
              value: "{$HOSTIP}"
            - name: master
              value: "{$OPENSEARCH.MASTER}"
            - name: password
              value: "{$OPENSEARCH.PASSWORD}"
            - name: port
              value: "9200"
            - name: username
              value: "{$OPENSEARCH.USERNAME}"
        - uuid: 1c529a6632cf4b2e9de6c4e88afea3da
          name: "Total count of Ingest"
          type: DEPENDENT
          key: opensearch.ingesthost.count
          delay: "0"
          preprocessing:
            - type: JSONPATH
              parameters:
                - $..ingest.total.count
            - type: TRIM
              parameters:
                - "[]"
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - "3600"
          master_item:
            key: opensearch.discover.nodes.stats
        - uuid: 8ea0937f9ce9498fb8a4e1bdbf302e93
          name: "Total count of failed Ingest"
          type: DEPENDENT
          key: opensearch.ingesthost.failed
          delay: "0"
          preprocessing:
            - type: JSONPATH
              parameters:
                - $..ingest.total.failed
            - type: TRIM
              parameters:
                - "[]"
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - "3600"
          master_item:
            key: opensearch.discover.nodes.stats
        - uuid: c51816a500924cbcb63cff637d584f10
          name: "Http connection currently Opened"
          type: DEPENDENT
          key: opensearch.ingesthost.http.current_open
          delay: "0"
          preprocessing:
            - type: JSONPATH
              parameters:
                - $..http.current_open
            - type: TRIM
              parameters:
                - "[]"
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - "3600"
          master_item:
            key: opensearch.discover.nodes.stats
        - uuid: 3bf3700b7c3c49f6a121ec15ef8b85fe
          name: "Http connection Total Opened"
          type: DEPENDENT
          key: opensearch.ingesthost.http.total_opened
          delay: "0"
          preprocessing:
            - type: JSONPATH
              parameters:
                - $..http.total_opened
            - type: TRIM
              parameters:
                - "[]"
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - "3600"
          master_item:
            key: opensearch.discover.nodes.stats
        - uuid: 22eb0b8494194dcf95207032cdc50464
          name: "Pipelines in use"
          type: DEPENDENT
          key: opensearch.ingesthost.pipelines
          delay: "0"
          value_type: TEXT
          trends: "0"
          preprocessing:
            - type: JSONPATH
              parameters:
                - $..ingest.pipelines
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - "3600"
          master_item:
            key: opensearch.discover.nodes.stats
